<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="pl" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>REST web service z Java EE część 2 - Samouczek Programisty</title>
<meta name="description" content="W artykule tym pokazuję przykład webservice’u, który został utworzony wyłącznie w oparciu o technologie z parasola Java EE. Znajdziesz tu praktyczne wykorzystanie wstrzykiwania zależności (CDI), walidacji (Bean Validation) czy obsługi formatu JSON (JSON-P i JSON-B). W praktyce JAX-RS pozwala na łatwe połączenie tych mechanizmów w całość. Artykuł przedstawia prosty webservice, napisany bez Springa. W artykule tym staram się pokazać, że nowoczesna Java EE nie jest taka straszna.">


  <meta name="author" content="Marcin Pietraszek">


<meta property="og:type" content="article">
<meta property="og:locale" content="pl">
<meta property="og:site_name" content="Samouczek Programisty">
<meta property="og:title" content="REST web service z Java EE część 2">
<meta property="og:url" content="https://www.samouczekprogramisty.pl/rest-web-service-z-java-ee-czesc-2/">


  <meta property="og:description" content="W artykule tym pokazuję przykład webservice’u, który został utworzony wyłącznie w oparciu o technologie z parasola Java EE. Znajdziesz tu praktyczne wykorzystanie wstrzykiwania zależności (CDI), walidacji (Bean Validation) czy obsługi formatu JSON (JSON-P i JSON-B). W praktyce JAX-RS pozwala na łatwe połączenie tych mechanizmów w całość. Artykuł przedstawia prosty webservice, napisany bez Springa. W artykule tym staram się pokazać, że nowoczesna Java EE nie jest taka straszna.">



  <meta property="og:image" content="https://www.samouczekprogramisty.pl/assets/images/2018/01/22_rest_web_service_2_artykul.jpg">





  <meta property="article:published_time" content="2018-01-22T00:00:00+01:00">



  <meta property="article:modified_time" content="2019-08-26T21:08:34+02:00">



  

  


<link rel="canonical" href="https://www.samouczekprogramisty.pl/rest-web-service-z-java-ee-czesc-2/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Marcin Pietraszek",
      "url": "https://www.samouczekprogramisty.pl/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Samouczek Programisty Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <link rel="shortcut icon" href="/assets/images/favicon.ico" /> 
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Samouczek Programisty
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/kurs-programowania-java/">Kurs programowania Java</a>
            </li><li class="masthead__menu-item">
              <a href="/kurs-aplikacji-webowych/">Kurs aplikacji webowych</a>
            </li><li class="masthead__menu-item">
              <a href="/kurs-sql/">Kurs SQL</a>
            </li><li class="masthead__menu-item">
              <a href="/kontakt/">Kontakt</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Przełącz menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<div class="page__hero--overlay"
  style=" background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('/assets/images/2018/01/22_rest_web_service_2_artykul.jpg');"
>
  
    <div class="wrapper">
      <h1 id="page-title" class="page__title" itemprop="headline">
        
          REST web service z Java EE część 2

        
      </h1>
      
        <p class="page__lead">W artykule tym pokazuję przykład webservice’u, który został utworzony wyłącznie w oparciu o technologie z parasola Java EE. Znajdziesz tu praktyczne wykorzystanie wstrzykiwania zależności (CDI), walidacji (Bean Validation) czy obsługi formatu JSON (JSON-P i JSON-B). W praktyce JAX-RS pozwala na łatwe połączenie tych mechanizmów w całość. Artykuł przedstawia prosty webservice, napisany bez Springa. W artykule tym staram się pokazać, że nowoczesna Java EE nie jest taka straszna.
</p>
      
      
        <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  11 minut(y)

</p>
      
      
      
    </div>
  
  
    <span class="page__hero-caption"><a href="https://www.flickr.com/photos/trevor_dobson_inefekt69/32936864910/sizes/l">© trevor_dobson_inefekt69</a>
</span>
  
</div>




  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://www.samouczekprogramisty.pl/" itemprop="item"><span itemprop="name">Strona główna</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">REST web service z Java EE część 2</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">

  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="REST web service z Java EE część 2">
    <meta itemprop="description" content="W artykule tym pokazuję przykład webservice’u, który został utworzony wyłącznie w oparciu o technologie z parasola Java EE. Znajdziesz tu praktyczne wykorzystanie wstrzykiwania zależności (CDI), walidacji (Bean Validation) czy obsługi formatu JSON (JSON-P i JSON-B). W praktyce JAX-RS pozwala na łatwe połączenie tych mechanizmów w całość. Artykuł przedstawia prosty webservice, napisany bez Springa. W artykule tym staram się pokazać, że nowoczesna Java EE nie jest taka straszna.">
    <meta itemprop="datePublished" content="January 22, 2018">
    <meta itemprop="dateModified" content="August 26, 2019">

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        <aside class="sidebar__right ">
          
          <nav class="toc">
            <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> Spis treści</h4></header>
            <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#rest-webservice-w-java-ee-8">REST Webservice w Java EE 8</a></li>
<li class="toc-entry toc-h2"><a href="#serwer-aplikacji-dla-javaee-8">Serwer aplikacji dla JavaEE 8</a></li>
<li class="toc-entry toc-h2"><a href="#wstrzykiwanie-zależności">Wstrzykiwanie zależności</a></li>
<li class="toc-entry toc-h2"><a href="#model--rezerwacja">Model – rezerwacja</a>
<ul>
<li class="toc-entry toc-h3"><a href="#walidacja">Walidacja</a></li>
<li class="toc-entry toc-h3"><a href="#dostęp-do-danych">Dostęp do danych</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#aplikacja">Aplikacja</a></li>
<li class="toc-entry toc-h2"><a href="#webservice">Webservice</a>
<ul>
<li class="toc-entry toc-h3"><a href="#pobranie-listy-rezerwacji">Pobranie listy rezerwacji</a></li>
<li class="toc-entry toc-h3"><a href="#pobieranie-pojedynczej-rezerwacji">Pobieranie pojedynczej rezerwacji</a></li>
<li class="toc-entry toc-h3"><a href="#usuwanie-rezerwacji">Usuwanie rezerwacji</a></li>
<li class="toc-entry toc-h3"><a href="#utworzenie-rezerwacji">Utworzenie rezerwacji</a></li>
<li class="toc-entry toc-h3"><a href="#modyfikacja-rezerwacji">Modyfikacja rezerwacji</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#własna-klasa-provider">Własna klasa @Provider</a></li>
<li class="toc-entry toc-h2"><a href="#dodatkowe-materiały-do-nauki">Dodatkowe materiały do nauki</a></li>
<li class="toc-entry toc-h2"><a href="#zadanie-do-wykonania">Zadanie do wykonania</a></li>
<li class="toc-entry toc-h2"><a href="#podsumowanie">Podsumowanie</a></li>
</ul>
          </nav>
          <hr />
          
          <div class="mailerlite__form">
            <script type="text/javascript" src="https://static.mailerlite.com/data/webforms/698980/y1i5k0.js?v7"></script>
          </div>
          <hr />
          <div class="fb-page">
            <a href="https://www.facebook.com/SamouczekProgramisty"><img src="/assets/images/facebook_logo.gif" alt="Profil Samouczka na Facebooku"/></a>
          </div>
        </aside>
        
<div class="notice--info">
  
<p>To jest jeden z artykułów w ramach <a href="https://www.samouczekprogramisty.pl/kurs-aplikacji-webowych/">darmowego kursu programowania aplikacji webowych w Javie</a>. Proszę zapoznaj się z pozostałymi częściami, mogą one być pomocne w zrozumieniu materiału z tego artykułu.</p>

<p>W kursie tym zakładam, że znasz język Java. Możesz go poznać w osobnym <a href="https://www.samouczekprogramisty.pl/kurs-programowania-java">kursie programowania w języku Java</a>. Do budowania wszystkich projetków używam Gradle, przeczytasz o nim więcej w <a href="/wstep-do-gradle/">osobnym artykule</a>.</p>

</div>

<h2 id="rest-webservice-w-java-ee-8">REST Webservice w Java EE 8</h2>

<p>Tematykę REST omówiłem dokładnie w <a href="/rest-web-service-z-java-ee-czesc-1/">poprzednim artykule</a>. W tym pokażę przykładową implementację webservice’u używającego wyłącznie technologii opisanych w ramach specyfikacji Java EE 8.</p>

<p>Przykładowa aplikacja będzie używała implementacji następujących specyfikacji:</p>

<ul>
  <li>JAX-RS: Java API for RESTful Web Services 2.1,</li>
  <li>JSON-B: JavaTM API for JSON Binding 1.0</li>
  <li>Java API for JSON Processing 1.1</li>
  <li>Context and Dependency Injection for Java 2.0</li>
  <li>Java TM Servlet Specification 3.1</li>
</ul>

<p>W artykule tym rozszerzę przykładowy webservice do zarządzania rezerwacjami. Będzie on posiadał pięć metod odpowiedzialnych odpowiednio za:</p>

<ul>
  <li>pobieranie listy rezerwacji,</li>
  <li>pobieranie konkretnej rezerwacji,</li>
  <li>tworzenie nowej rezerwacji,</li>
  <li>edycja rezerwacji,</li>
  <li>usunięcie rezerwacji.</li>
</ul>

<h2 id="serwer-aplikacji-dla-javaee-8">Serwer aplikacji dla JavaEE 8</h2>

<p>W poprzednim artykule posłużyłem się kontenerem aplikacji TomEE. Także i tym razem polecam użycie tego kontenera aplikacji. Jeśli chcesz wiedzieć więcej o jego instalacji zapraszam Cię do <a href="/rest-web-service-z-java-ee-czesc-1/#instalacja-kontenera-aplikacji">poprzedniego artykułu</a>.</p>

<h2 id="wstrzykiwanie-zależności">Wstrzykiwanie zależności</h2>

<p>Wstrzykiwanie zależności (ang. <em>dependency injection</em>) pozwala na oddelegowanie zarządzanie zależnościami do kontenera. Dzięki takiemu podejściu programista nie musi samemu tworzyć instancji obiektów, robi to za niego kontener aplikacji. Kontener aplikacji zarządza cyklem życia takich instancji. To kontener wywołuje konstruktor i kontener utrzymuje referencje do tych obiektów. Także kontener ustawia atrybuty jeśli odpowiadają one instancjom, którymi zarządza.</p>

<p>Takie podejście do zarządzania obiektami znacząco upraszcza aplikacje. Pozwala też tworzyć kod, który można w łatwiejszy sposób przetestować przy pomocy <a href="/testy-jednostkowe-z-junit/">testów jednostkowych</a>.</p>

<p class="notice--info">Wstrzykiwanie zależności to funkcjonalność, dzięki której Spring stał się tak popularny. W początkowych fazach istnienia biblioteki Spring jej możliwości sprowadzały się do przyjaznego zarządzania zależnościami.</p>

<p>Proszę spójrz na przykład:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReservationWebservice</span> <span class="o">{</span>
    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="nc">ReservationDAO</span> <span class="n">dao</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@ApplicationScoped</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReservationDAO</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Fragment kodu powyżej używa mechanizmu wstrzykiwania zależności. Klasa <code class="highlighter-rouge">ReservationWebservice</code> potrzebuje instancji klasy <code class="highlighter-rouge">ReservationDAO</code><sup id="fnref:dao" role="doc-noteref"><a href="#fn:dao" class="footnote">1</a></sup>. Atrybut <code class="highlighter-rouge">dao</code> może zostać wstrzyknięty dzięki mechanizmowi DI (ang. <em>Dependency Injection</em>). Adnotacja <a href="https://javaee.github.io/javaee-spec/javadocs/javax/inject/Inject.html"><code class="highlighter-rouge">@Inject</code></a> informuje kontener o tym, że ten atrybut powinien zostać wstrzyknięty.</p>

<p>Klasa <code class="highlighter-rouge">ReservationDAO</code> poprzedzona jest adnotacją <a href="https://javaee.github.io/javaee-spec/javadocs/javax/enterprise/context/ApplicationScoped.html"><code class="highlighter-rouge">@ApplicationScoped</code></a>. Adnotacja ta informuje kontener o tym, że instancja tej klasy powinna być możliwa do wstrzyknięcia. Instancja będzie dostępna w kontekście aplikacji. Oznacza to tyle, że kontener utworzy wyłącznie jedną instancję tej klasy w trakcie działania aplikacji<sup id="fnref:serwery" role="doc-noteref"><a href="#fn:serwery" class="footnote">2</a></sup>.</p>

<h2 id="model--rezerwacja">Model – rezerwacja</h2>

<p>Rezerwacje, którymi zarządza webservice są reprezentowane przez osobną klasę <code class="highlighter-rouge">Reservation</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Reservation</span> <span class="o">{</span>

    <span class="nd">@NotEmpty</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@NotNull</span>
    <span class="nd">@Positive</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">tableNumber</span><span class="o">;</span>

    <span class="nd">@FutureOrPresent</span>
    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">start</span><span class="o">;</span>

    <span class="nd">@Future</span>
    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">end</span><span class="o">;</span>

    <span class="c1">// getters/setters</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Klasa ta zawiera atrybuty opisujące rezerwację takie jak nazwisko rezerwującego, numer stolika czy początek i koniec rezerwacji. Rezerwacja jest prawidłowa wyłącznie jeśli atrybuty uzupełnione są poprawnymi danymi. Poprawność instancji klasy <code class="highlighter-rouge">Reservation</code> zapewniona jest przez <a href="/walidacja-obiektow-w-jezyku-java/">mechanizm walidacji</a>.</p>

<h3 id="walidacja">Walidacja</h3>

<p>Walidacja obiektów dostarczona jest przez implementację specyfikacji Bean Validation. Każdy kontener aplikacji, który jest kompatybilny z Java EE 8 (jak TomEE wspomniany wyżej), musi dostarczać implementację tej specyfikacji.</p>

<p>Samą <a href="/walidacja-obiektow-w-jezyku-java/">walidację obiektów</a> omówiłem bardziej szczegółowo w osobnym artykule. Tutaj widzisz jej użycie w kontekście aplikacji webowej.</p>

<p>Instancja walidatora tworzona jest przez kontener automatycznie. Kontener także wywołuje mechanizm walidacji. Mechanizm ten wywoływany jest za każdym razem w metodach obsługujących podstawowe operacje. Przykład poniżej pokazuje użycie adnotacji <a href="https://javaee.github.io/javaee-spec/javadocs/javax/validation/Valid.html"><code class="highlighter-rouge">@Valid</code></a> w metodzie odpowiedzialnej za tworzenie nowej instancji rezerwacji.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@POST</span>
<span class="kd">public</span> <span class="nc">Response</span> <span class="nf">createReservation</span><span class="o">(</span><span class="nd">@Valid</span> <span class="nc">Reservation</span> <span class="n">reservation</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Kontener na podstawie zapytania wysłanego przez użytkownika tworzy instancję klasy <code class="highlighter-rouge">Reservation</code>, następnie sprawdza czy instancja ta jest poprawna. Jeśli dane przesłane przez użytkownika są poprawne wówczas wywołuje ciało metody. Jeśli dane nie pozwolą na utworzenie poprawnej instancji wówczas zostanie rzucony <a href="%{ post_url 2016-01-31-wyjatki-w-jezyku-java %}">wyjątek</a><a href="https://javaee.github.io/javaee-spec/javadocs/javax/validation/ValidationException.html"><code class="highlighter-rouge">ValidationException</code></a>.</p>

<p>W akapicie opisującym instancje oznaczone adnotacją <a href="https://javaee.github.io/javaee-spec/javadocs/javax/ws/rs/ext/Provider.html"><code class="highlighter-rouge">@Provider</code></a> opiszę ten mechanizm dokładniej.</p>

<div class="notice--success text-center">
  
<p><span class="c_almost-header">Pobierz opracowania zadań z rozmów kwalifikacyjnych</span></p>

<p>Przygotowałem rozwiązania kilku zadań algorytmicznych z rozmów kwalifikacyjnych. Rozkładam je na czynniki pierwsze i pokazuję różne sposoby ich rozwiązania. Dołącz do grupy <strong>ponad 6147 Samouków</strong>, którzy jako pierwsi dowiadują się o nowych treściach na blogu, a prześlę je na Twój e-mail.</p>

<script type="text/javascript" src="https://static.mailerlite.com/data/webforms/704312/f8q4i2.js?v4"></script>


</div>

<h3 id="dostęp-do-danych">Dostęp do danych</h3>

<p>W normalnej wersji aplikacji dane zapisywane są w dedykowanej bazie danych<sup id="fnref:baza" role="doc-noteref"><a href="#fn:baza" class="footnote">3</a></sup>. Na potrzeby tej aplikacji symuluję bazę danych przy pomocy <a href="/struktury-danych-tablica-asocjacyjna/">mapy</a> przechowywanej w pamięci. Oczywistym minusem jest to, że dane nie są zachowywane po wyłączeniu aplikacji. Na potrzeby tego artykułu taki mechanizm jest wystarczający:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ApplicationScoped</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReservationDAO</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Reservation</span><span class="o">&gt;</span> <span class="n">reservations</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">synchronizedMap</span><span class="o">(</span><span class="k">new</span> <span class="nc">TreeMap</span><span class="o">&lt;&gt;());;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">AtomicInteger</span> <span class="n">lastId</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AtomicInteger</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

    <span class="kd">public</span> <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">Reservation</span><span class="o">&gt;</span> <span class="nf">getAll</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">reservations</span><span class="o">.</span><span class="na">values</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Reservation</span> <span class="nf">getById</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">reservations</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Reservation</span> <span class="nf">updateReservation</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="nc">Reservation</span> <span class="n">reservation</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">reservations</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">reservation</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Reservation</span> <span class="nf">deleteReservation</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">reservations</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">createReservation</span><span class="o">(</span><span class="nc">Reservation</span> <span class="n">reservation</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">lastId</span><span class="o">.</span><span class="na">getAndIncrement</span><span class="o">();</span>
        <span class="n">reservations</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">reservation</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Klasa <code class="highlighter-rouge">ReservationDAO</code> pozwala na łatwy dostęp do instancji klasy <code class="highlighter-rouge">Reservation</code> przechowywanych w pamięci. Pozwala na utworzenie, pobranie, usunięcie i edycję rezerwacji.</p>

<p>Jak wspomniałem wyżej w akapicie opisującym wstrzykiwanie zależności, instancja klasy <code class="highlighter-rouge">ReservationDAO</code> jest zarządzana przez kontener aplikacji. W ramach całej aplikacji zostanie utworzona wyłącznie jedna instancja tej klasy. Ta instancja będzie wykorzystywana przez klasę obsługującą żądania wysyłane przez użytkownika.</p>

<h2 id="aplikacja">Aplikacja</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ApplicationPath</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RegistrationApplication</span> <span class="kd">extends</span> <span class="nc">Application</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Adnotacja <a href="https://javaee.github.io/javaee-spec/javadocs/javax/ws/rs/ApplicationPath.html"><code class="highlighter-rouge">@ApplicationPath</code></a> informuje kontener aplikacji o początkowym członie adresu URL pod jakim działa dana aplikacja. W przykładzie wyżej informuję kontener o tym, że adresy URL dla wszystkich webservice’ów w tej aplikacji poprzedzone są <code class="highlighter-rouge">/</code>.</p>

<p>Adnotacja ta może zostać dodana wyłącznie do instancji klasy <a href="https://javaee.github.io/javaee-spec/javadocs/javax/ws/rs/core/Application.html"><code class="highlighter-rouge">Application</code></a>. Klasa ta dostarcza dodatkowych metadanych o aplikacji. W moim przypadku jedyną wymaganą informacją dodatkową jest ta dostarczona przez adnotację.</p>

<p class="notice--info">Podobnie jak w <a href="/rest-web-service-z-java-ee-czesc-1/#pierwszy-web-service">poprzednim artykule</a> zakładam, że aplikacja w kontenerze zostanie zainstalowana jako <code class="highlighter-rouge">rest.war</code>.</p>

<h2 id="webservice">Webservice</h2>

<p>Teraz znasz komponenty, które są wykorzystywane przez webservice. Nadszedł czas na klasę obsługują żądania użytkownika:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Path</span><span class="o">(</span><span class="s">"/reservation"</span><span class="o">)</span>
<span class="nd">@Produces</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
<span class="nd">@Consumes</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReservationWebservice</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="nc">ReservationDAO</span> <span class="n">dao</span><span class="o">;</span>

<span class="o">}</span>
</code></pre></div></div>

<p>Adnotację <a href="https://javaee.github.io/javaee-spec/javadocs/javax/ws/rs/Path.html"><code class="highlighter-rouge">@Path</code></a> znasz z <a href="/rest-web-service-z-java-ee-czesc-1/">poprzedniej części artykułu</a>. Określa ona ścieżkę, która obsługiwana jest przez daną klasę.</p>

<p>Nowe są dla Ciebie adnotacje <a href="https://javaee.github.io/javaee-spec/javadocs/javax/ws/rs/Consumes.html"><code class="highlighter-rouge">@Consumes</code></a> i <a href="https://javaee.github.io/javaee-spec/javadocs/javax/enterprise/inject/Produces.html"><code class="highlighter-rouge">@Produces</code></a>. Odpowiadają one odpowiednio za określenie typu danych konsumowanych i produkowanych przez webservice. W tym przypadku są to dane w formacie <a href="/format-json-w-jezyku-java/">JSON</a>.</p>

<p>Jeśli użytkownik wyśle zapytanie zawierające dane w innym formacie wówczas kontener automatycznie odpowie zwracając kod <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/415">415</a>. Kod ten informuje klienty o tym, że format danych nie jest wspierany.</p>

<p>Wewnątrz klasy widzisz atrybut, który zostanie wstrzyknięty przez kontener aplikacji. Jest to instancja klasy <code class="highlighter-rouge">ReservationDAO</code> pozwalająca na dostęp do aktualnie dostępnych rezerwacji.</p>

<p>Zgodnie ze specyfikacją JAX-RS dla każdego żądania przychodzącego od użytkownika zostanie utworzona nowa instancja klasy <code class="highlighter-rouge">ReservationWebservice</code>. Po raz kolejny to kontener aplikacji zajmuje się tworzeniem tych instancji.</p>

<h3 id="pobranie-listy-rezerwacji">Pobranie listy rezerwacji</h3>

<p>Kod odpowiedzialny za pobranie wszystkich rezerwacji nie jest zbyt skomplikowany:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GET</span>
<span class="kd">public</span> <span class="nc">Response</span> <span class="nf">listReservations</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Response</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">dao</span><span class="o">.</span><span class="na">getAll</span><span class="o">()).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Metoda <code class="highlighter-rouge">listReservations</code> poprzedzona jest adnotacją <a href="https://javaee.github.io/javaee-spec/javadocs/javax/ws/rs/GET.html"><code class="highlighter-rouge">@GET</code></a>. Nie zawiera dodatkowej adnotacji <code class="highlighter-rouge">@Path</code>, więc wszystkie żądania wysłane pod adres <code class="highlighter-rouge">GET /rest/reservation</code> zostaną obsłużone przez tę metodę. Do sprawdzenia jej działania możesz użyć programu <a href="https://curl.haxx.se/"><code class="highlighter-rouge">curl</code></a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -H "Content-Type: application/json" http://localhost:8080/rest/reservation
</code></pre></div></div>

<p><code class="highlighter-rouge">-H "Content-Type: application/json"</code> dodaje nagłówek do żądania. Określa on format zawartości zapytania. To właśnie ten nagłówek sprawdzany jest przez adnotację <code class="highlighter-rouge">@Consumes</code>.</p>

<p>Wewnątrz metody buduję odpowiedź. Ciałem tej odpowiedzi jest lista rezerwacji zwrócona przez <code class="highlighter-rouge">dao</code>. Dzięki adnotacji <code class="highlighter-rouge">@Produces</code> JAX-RS wymusza format odpowiedzi. W moim przypadku jest to JSON.</p>

<p>Kontener automatycznie przekonwertuje instancję klasy <code class="highlighter-rouge">Reservation</code> do formatu JSON. Dzieje się to dzięki implementacji specyfikacji JSON-B i JSON-P.</p>

<h3 id="pobieranie-pojedynczej-rezerwacji">Pobieranie pojedynczej rezerwacji</h3>

<p>Pobieranie pojedynczej rezerwacji również bazuje na atrybucie <code class="highlighter-rouge">dao</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GET</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">"{id}"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Response</span> <span class="nf">getReservation</span><span class="o">(</span><span class="nd">@PathParam</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nd">@Min</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Reservation</span> <span class="n">reservation</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">getById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">reservation</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Response</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">reservation</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="nc">Response</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="nc">Response</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Dodatkowa adnotacja <code class="highlighter-rouge">@Path</code> rozszerza tę umieszczoną nad klasą <code class="highlighter-rouge">ReservationWebservice</code>. W wyniku tego metoda <code class="highlighter-rouge">getReservation</code> obsługuje wszystkie żądania wysłane przez klienty na adres <code class="highlighter-rouge">GET /reservation/{id}</code>. <code class="highlighter-rouge">id</code> jest identyfikatorem rezerwacji pobieranym z adresu URL dzięki adnotacji <a href="https://javaee.github.io/javaee-spec/javadocs/javax/ws/rs/PathParam.html"><code class="highlighter-rouge">@PathParam</code></a>.</p>

<p>Zwróć także uwagę na użycie adnotacji <a href="https://javaee.github.io/javaee-spec/javadocs/javax/validation/constraints/Min.html"><code class="highlighter-rouge">@Min</code></a>. Adnotacja ta uruchomi mechanizm walidacji dla parametru <code class="highlighter-rouge">id</code>. Mechanizm ten sprawdzi czy liczba przekazana w adresie ma wartość większą, bądź równą 0. Jeśli wartość parametru jest niepoprawna zostanie rzucony wyjątek.</p>

<p>Wewnątrz ciała metody odwołuję się do atrybutu <code class="highlighter-rouge">dao</code> pobierając rezerwację na podstawie identyfikatora pobranego od użytkownika. <code class="highlighter-rouge">dao</code> zwróci wartość <code class="highlighter-rouge">null</code> jeśli rezerwacja o danym identyfikatorze nie zostanie odnaleziona. W takim przypadku klient uzyska odpowiedź z kodem <a href="https://developer.mozilla.org/uk/docs/Web/HTTP/Status/404">404</a> informującą o braku szukanego elementu.</p>

<p>Jeśli <code class="highlighter-rouge">dao</code> znajdzie rezerwację o zadanym identyfikatorze, wówczas zostanie ona przekazana w odpowiedzi. Także tutaj zostanie ona przekształcona do formatu JSON.</p>

<p>Także w tym przypadku <code class="highlighter-rouge">curl</code> może pomóc w wysłaniu zapytania:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -H "Content-Type: application/json" http://localhost:8080/rest/reservation/0 
</code></pre></div></div>

<h3 id="usuwanie-rezerwacji">Usuwanie rezerwacji</h3>

<p>Usuwanie rezerwacji niewiele różni się od pobierania pojedynczej wartości:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@DELETE</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">"{id}"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Response</span> <span class="nf">deleteReservation</span><span class="o">(</span><span class="nd">@PathParam</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nd">@Min</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Reservation</span> <span class="n">reservation</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">deleteReservation</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">reservation</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Response</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">reservation</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="nc">Response</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="nc">Response</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>W tym przypadku kombinacja adnotacji <a href="https://javaee.github.io/javaee-spec/javadocs/javax/ws/rs/DELETE.html"><code class="highlighter-rouge">@DELETE</code></a> i <code class="highlighter-rouge">@Path</code> wskazuje, że metoda ta zostanie wywołana w przypadku wysłania żądania na adres <code class="highlighter-rouge">DELETE /reservation/{id}</code>. Podobnie jak w przypadku pobierania rezerwacji mechanizm walidacja sprawdza poprawność przekazanego parametru <code class="highlighter-rouge">id</code>.</p>

<p>W przypadku tej metody <code class="highlighter-rouge">dao</code> użyte jest do usunięcia rezerwacji o podanym identyfikatorze.</p>

<p>Przykładowe wywołanie <code class="highlighter-rouge">curl</code> usuwające rezerwację o identyfikatorze 0:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -H "Content-Type: application/json" http://localhost:8080/rest/reservation/0 -X DELETE
</code></pre></div></div>

<h3 id="utworzenie-rezerwacji">Utworzenie rezerwacji</h3>

<p>Podczas tworzenia rezerwacji webservice wymusza poprawność danych przekazanych przez użytkownika. To adnotacja <a href="https://javaee.github.io/javaee-spec/javadocs/javax/validation/Valid.html"><code class="highlighter-rouge">@Valid</code></a> wymusza sprawdzenie poprawności danych:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@POST</span>
<span class="kd">public</span> <span class="nc">Response</span> <span class="nf">createReservation</span><span class="o">(</span><span class="nd">@Valid</span> <span class="nc">Reservation</span> <span class="n">reservation</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">newId</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">createReservation</span><span class="o">(</span><span class="n">reservation</span><span class="o">);</span>
    <span class="no">URI</span> <span class="n">location</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">location</span> <span class="o">=</span> <span class="k">new</span> <span class="no">URI</span><span class="o">(</span><span class="s">"reservation/"</span> <span class="o">+</span> <span class="n">newId</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">URISyntaxException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="nc">Response</span><span class="o">.</span><span class="na">created</span><span class="o">(</span><span class="n">location</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Jeśli wszystkie wymagania określone w klasie <code class="highlighter-rouge">Reservation</code> zostaną spełnione zostanie wywołana metoda <code class="highlighter-rouge">createReservation</code>. W przeciwnym wypadku zostanie rzucony wyjątek <code class="highlighter-rouge">ValidationException</code>.</p>

<p>W ciele metody <code class="highlighter-rouge">createReservation</code> wywołuję <code class="highlighter-rouge">dao.createReservation</code>. To wywołanie zapisuje nową rezerwację w bazie danych. W wyniku wywołania tej metody zwrócony jest nowy identyfikator dla tej rezerwacji. Pomaga on w utworzeniu adresu URL, który zostaje zwrócony w odpowiedzi.</p>

<p>Także i tutaj <code class="highlighter-rouge">curl</code> może zostać użyty do wysłania zapytania. Tym razem w ciele zapytania muszę przesłać dane w formacie JSON, które reprezentują nową rezerwację. Przykładowe zapytanie może wyglądać następująco:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -H "Content-Type: application/json" http://localhost:8080/rest/reservation -X POST -d '{"start": "2018-01-22T20:00", "tableNumber": 1, "name": "Marcin", "end": "2018-01-22T21:20"}'
</code></pre></div></div>

<p>Parametr <code class="highlighter-rouge">-d</code> służy do przekazania zawartości zapytania. W tym przypadku jest to JSON, który reprezentuje dane potrzebne do utworzenia instancji klasy <code class="highlighter-rouge">Reservation</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "name": "Marcin",
    "tableNumber": 1,
    "start": "2018-01-22T20:00",
    "end": "2018-01-22T21:20"
}
</code></pre></div></div>

<p>W przykładzie powyżej instancja reprezentowana jest przez mapę. Kluczami są nazwy atrybutów, na przykład <code class="highlighter-rouge">name</code> czy <code class="highlighter-rouge">start</code>. Atrybuty klasy zostaną uzupełnione wartościami przekazanymi w mapie. Oczywiście format wartości musi być odpowiedni. Automatyczna transformacja pomiędzy formatem JSON a klasą Java możliwa jest dzięki specyfikacjom JSON-B i JSON-P.</p>

<h3 id="modyfikacja-rezerwacji">Modyfikacja rezerwacji</h3>

<p>Modyfikacja rezerwacji nie zawiera nowych mechanizmów. Jest dość podobna do tworzenia nowej instancji:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PUT</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">"{id}"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Response</span> <span class="nf">updateReservation</span><span class="o">(</span><span class="nd">@PathParam</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nd">@Min</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@Valid</span> <span class="nc">Reservation</span> <span class="n">reservation</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">boolean</span> <span class="n">hasReservation</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">getById</span><span class="o">(</span><span class="n">id</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">hasReservation</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">dao</span><span class="o">.</span><span class="na">updateReservation</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">reservation</span><span class="o">);</span>
        <span class="k">return</span> <span class="nc">Response</span><span class="o">.</span><span class="na">noContent</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="nc">Response</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="nc">Response</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="własna-klasa-provider">Własna klasa <a href="https://javaee.github.io/javaee-spec/javadocs/javax/ws/rs/ext/Provider.html"><code class="highlighter-rouge">@Provider</code></a></h2>

<p>W <a href="/rest-web-service-z-java-ee-czesc-1/">poprzedniej części</a> artykułu użyłem tej adnotacji to utworzenia filtra, który dodawał nagłówki. Tym razem posłuży ona do pomocy przy walidacji.</p>

<p>Specyfikacja JAX-RS pozwala na utworzenie klasy, która będzie odpowiedzialna za obsługę wyjątków, które wystąpiły w trakcie przetwarzania żądania klienta. To zastosowanie idealnie nadaje się do obsługi błędów walidacji:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Provider</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ValidationExceptionMapper</span> <span class="kd">implements</span> <span class="nc">ExceptionMapper</span><span class="o">&lt;</span><span class="nc">ConstraintViolationException</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ErrorMessage</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">error</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">ErrorMessage</span><span class="o">(</span><span class="nc">String</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">error</span> <span class="o">=</span> <span class="n">error</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Response</span> <span class="nf">toResponse</span><span class="o">(</span><span class="nc">ConstraintViolationException</span> <span class="n">exception</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Response</span>
                <span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="nc">Response</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">BAD_REQUEST</span><span class="o">)</span>
                <span class="o">.</span><span class="na">entity</span><span class="o">(</span><span class="k">new</span> <span class="nc">ErrorMessage</span><span class="o">(</span><span class="n">exception</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Klasa <code class="highlighter-rouge">ValidationExceptionMapper</code> implementuje interfejs <a href="https://javaee.github.io/javaee-spec/javadocs/javax/ws/rs/ext/ExceptionMapper.html"><code class="highlighter-rouge">ExceptionMapper</code></a>. Interfejs ten zawiera wyłącznie jedną metodę <code class="highlighter-rouge">toResponse</code>. Metoda ta zostaje wywołana jeśli zostanie rzucony wyjątek obsługiwany przez daną klasę.</p>

<p>W moim przypadku tworzę nową odpowiedź, która zwraca kod błędu <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400">400</a> wraz z dodatkowym komunikatem błędu zwróconym przez mechanizm walidacji.</p>

<div class="notice--warning">
    
<p>W związku z <a href="https://github.com/jersey/jersey/issues/3425">błędem</a> w bibliotece Jersey musiałem utworzyć klasę, która obsługuje wyjątek <a href="https://javaee.github.io/javaee-spec/javadocs/javax/validation/ConstraintViolationException.html"><code class="highlighter-rouge">ConstraintViolationException</code></a>. Po rozwiązaniu tego błędu klasa ta powinna obsługiwać wyjątek <a href="https://javaee.github.io/javaee-spec/javadocs/javax/validation/ValidationException.html"><code class="highlighter-rouge">ValidationException</code></a>.</p>

<p>Zgodnie ze specyfikacją użycie adnotacji <a href="https://javaee.github.io/javaee-spec/javadocs/javax/annotation/Priority.html"><code class="highlighter-rouge">@Priority</code></a> także powinno pomóc obejść ten problem.</p>

</div>

<h2 id="dodatkowe-materiały-do-nauki">Dodatkowe materiały do nauki</h2>

<p>W tym miejscu poproszę Cię o uruchomienie tej aplikacji na swoim komputerze i testowanie jej przy pomocy programu <code class="highlighter-rouge">curl</code>. Taka zabawa na żywo potrafi sporo nauczyć. Kod źródłowy aplikacji znajdziesz na <a href="https://github.com/SamouczekProgramisty/KursAplikacjeWebowe/tree/master/07_rest_crud">samouczkowym githubie</a>.</p>

<h2 id="zadanie-do-wykonania">Zadanie do wykonania</h2>

<p>Kod źródłowy aplikacji użytej w artykule znajduje się na samouczkowym githubie. Twoim zadaniem jest rozszerzenie działania tej aplikacji. W obecnym kształcie aplikacja nie sprawdza czy dany stolik nie jest już zarezerwowany. Może to prowadzić do sytuacji, w której ten sam stolik będzie zarezerwowany w tym samym czasie dla więcej niż jednej osoby.</p>

<p>Popraw aplikację w taki sposób, aby nie pozwalała na ponowną rezerwację już zarezerwowanego stolika. Więc jeśli stolik nr 1. jest zarezerwowany w godzinach od 17:00 do 18:30, to rezerwacja na ten sam stolik od 18:10 do 19:00 nie jest możliwa.</p>

<h2 id="podsumowanie">Podsumowanie</h2>

<p>W artykule przeczytałeś o praktycznym zastosowaniu kilku specyfikacji z parasola Java EE. Na przykładzie mogłeś zobaczyć użycie walidacji czy wstrzykiwania zależności. Poznałeś też mechanizm obsługi wyjątków, w którym użyłem adnotacji <code class="highlighter-rouge">@Provider</code>. Użyłeś implementacji specyfikacji JSON-P i JSON-B pozwalających na proste obsługiwanie danych w formacie JSON. Całość opakowana została w webservice, oparty o specyfikację JAX-RS. Mam nadzieję, że przykłady użyte w artykule pozwoliły Ci spojrzeć na Java EE z innej strony.</p>

<p>Jeśli którakolwiek część artykułu nie jest dla Ciebie jasna proszę daj znać. Postaram się pomóc. Jeśli nie chcesz ominąć kolejnych artykułów w przyszłości proszę dopisz się do samouczkowego newslettera i polub stronę Samouczka na Facebooku. Do następnego razu!</p>
<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:dao" role="doc-endnote">
      <p>DAO to akronim od <em>Data Access Object</em>. Jest to często spotykany sposób na oznaczenie klas, które odpowiedzialne są za dostęp do danych. <a href="#fnref:dao" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:serwery" role="doc-endnote">
      <p>Mam na myśli tutaj jedną instancję klasy na każdą wirtualną maszynę Javy. Jeśli aplikacja uruchomiona jest w kliku kontenerach wówczas każdy z nich będzie miał osobną instancję. <a href="#fnref:serwery" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:baza" role="doc-endnote">
      <p>Raz jest to zwykła baza relacyjna, innym razem może to być plik na dysku. W przypadku niektórych aplikacji wymaganiem może okazać się użycie innych mechanizmów jak na przykład bazy “nosql”, czy rozproszone systemy plików. Wszystko zależy od wymagań stawianych przed daną aplikacją. <a href="#fnref:baza" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

        

<div class="notice--success text-center">
  
<p><span class="c_almost-header">Pobierz opracowania zadań z rozmów kwalifikacyjnych</span></p>

<p>Przygotowałem rozwiązania kilku zadań algorytmicznych z rozmów kwalifikacyjnych. Rozkładam je na czynniki pierwsze i pokazuję różne sposoby ich rozwiązania. Dołącz do grupy <strong>ponad 6147 Samouków</strong>, którzy jako pierwsi dowiadują się o nowych treściach na blogu, a prześlę je na Twój e-mail.</p>

<script type="text/javascript" src="https://static.mailerlite.com/data/webforms/698960/m0b4d5.js?v4"></script>


</div>

        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Kategorie: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/kategorie/#kurs-aplikacji-webowych" class="page__taxonomy-item" rel="tag">Kurs aplikacji webowych</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Ostatnia aktualizacja:</strong> <time datetime="2019-08-26">2019-08-26</time></p>
        
        <p><strong><i class="fas fa-fw fa-child" aria-hidden="true"></i> Autor: </strong><a href="/o-mnie/">Marcin Pietraszek</a></p>
        <hr />
        <p>
          Nie popełnia błędów tylko ten, kto nic nie robi ;). Bardzo możliwe, że znajdziesz błąd, literówkę, coś co wymaga poprawy. Jeśli chcesz możesz samodzielnie 
          <a href="https://github.com/SamouczekProgramisty/samouczekprogramisty.github.io/edit/source/_posts/2018-01-22-rest-webservice-z-java-ee-czesc-2.md">poprawić tę stronę</a>. Jeśli nie chcesz poprawiać błędu, który udało Ci się znaleźć będę wdzięczny jeśli go 
          <a href="https://github.com/SamouczekProgramisty/samouczekprogramisty.github.io/issues/new?title=Błąd%20na%20stronie:%20_posts/2018-01-22-rest-webservice-z-java-ee-czesc-2.md">zgłosisz</a>. Z góry dziękuję!
        </p>
      </footer>
    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Zostaw komentarz</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">Także może Ci się spodobać</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/2019/02/02_watki_w_jezyku_java_artykul.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/watki-w-jezyku-java/" rel="permalink">Wątki w języku Java
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  10 minut(y)

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Artykuł ten opisuje wątki w języku Java. Po jego lekturze dowiesz się czym jest wątek, jaki ma cykl życia i jak go uruchomić. Dowiesz się czym jest synchroni...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/2017/11/20_rest_web_service_artykul.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/rest-web-service-z-java-ee-czesc-1/" rel="permalink">REST web service z Java EE część 1
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  11 minut(y)

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Po lekturze tego artykułu będziesz wiedział czym jest web service. Przeczytasz o tym czym jest REST. Dowiesz się dlaczego zdobył taką popularność. Zainstaluj...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/2017/12/04_walidacja_obiektow_w_jezyku_java_artykul.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/walidacja-obiektow-w-jezyku-java/" rel="permalink">Walidacja obiektów w języku Java
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  11 minut(y)

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Artykuł opisuje mechanizm walidacji obiektów. Po lekturze tego artykułu dowiesz się czym jest specyfikacja Bean Validation. Poznasz najczęściej używane reguł...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/2018/02/08_protokol_http_artykul.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/protokol-http/" rel="permalink">Protokół HTTP
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  10 minut(y)

</p>
    
    <p class="archive__item-excerpt" itemprop="description">W artykule tym dowiesz się więcej o protokole HTTP. Przeczytasz o ciasteczkach, nagłówkach i czasownikach HTTP. Dowiesz się czym jest idempotentność. Poznasz...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><div class="search-searchbar"></div>
  <div class="search-hits"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">

    
      <li><strong>Śledź:</strong></li>
    

    
      
        
          <li><a href="https://www.facebook.com/SamouczekProgramisty" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i> Facebook</a></li>
        
      
        
          <li><a href="https://github.com/SamouczekProgramisty" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.youtube.com/channel/UCisPQ5nxB6yw3SfJPFWKTEg" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> YouTube</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>

  <ul>
    <li><a href="https://www.samouczekprogramisty.pl/o-mnie/">O mnie</a></li>
    <li><a href="https://www.samouczekprogramisty.pl/o-blogu/">O blogu</a></li>
    <li><a href="https://www.samouczekprogramisty.pl/polityka-prywatnosci/">Polityka prywatności</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2015-2021 Marcin Pietraszek</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>


<!-- Including InstantSearch.js library and styling -->
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css">

<script>
// Instanciating InstantSearch.js with Algolia credentials
const search = instantsearch({
  appId: 'BAIWADE3K7',
  apiKey: '4a78df6a4d9f820ebbdb0a35f834b174',
  indexName: 'prod_samouczek',
  searchParameters: {
    restrictSearchableAttributes: [
      'title',
      'content'
    ]
  }
});

const hitTemplate = function(hit) {
  const url = hit.url;
  const title = hit._highlightResult.title.value;
  const content = hit._highlightResult.html.value;

  return `
    <div class="list__item">
      <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
        <h2 class="archive__item-title" itemprop="headline"><a href="${url}">${title}</a></h2>
        <div class="archive__item-excerpt" itemprop="description">${content}</div>
      </article>
    </div>
  `;
}

// Adding searchbar and results widgets
search.addWidget(
  instantsearch.widgets.searchBox({
    container: '.search-searchbar',
    poweredBy: true,
    placeholder: 'Szukaj...'
  })
);
search.addWidget(
  instantsearch.widgets.hits({
    container: '.search-hits',
    templates: {
      item: hitTemplate,
      empty: 'Brak wyników',
    }
  })
);

// Starting the search only when toggle is clicked
$(document).ready(function () {
  $(".search__toggle").on("click", function() {
    if(!search.started) {
      search.start();
    }
  });
});
</script>





  <script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-68536783-1']);
  
    _gaq.push(['_gat._anonymizeIp']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://www.samouczekprogramisty.pl/rest-web-service-z-java-ee-czesc-2/";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = ""; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://samouczekprogramisty.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Proszę włacz obsługę JavaScript żeby móc zobaczyć komentarze.</noscript>


  





  </body>
</html>
