<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="pl" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Serializacja w języku Java - Samouczek Programisty</title>
<meta name="description" content="W artykule tym dowiesz się czym jest serializacja obiektów w Javie. Przeczytasz o klasach takich jak ObjectInputStream czy ObjectOutputStream i dowiesz się czym różnią się od innych strumieni. Poznasz nowe słowo kluczowe transient. Po przeczytaniu artykułu będziesz w stanie napisać swoją mini bazę danych z użyciem mechanizmu serializacji. Zapraszam do lektury.">


  <meta name="author" content="Marcin Pietraszek">


<meta property="og:type" content="article">
<meta property="og:locale" content="pl">
<meta property="og:site_name" content="Samouczek Programisty">
<meta property="og:title" content="Serializacja w języku Java">
<meta property="og:url" content="https://www.samouczekprogramisty.pl/serializacja-w-jezyku-java/">


  <meta property="og:description" content="W artykule tym dowiesz się czym jest serializacja obiektów w Javie. Przeczytasz o klasach takich jak ObjectInputStream czy ObjectOutputStream i dowiesz się czym różnią się od innych strumieni. Poznasz nowe słowo kluczowe transient. Po przeczytaniu artykułu będziesz w stanie napisać swoją mini bazę danych z użyciem mechanizmu serializacji. Zapraszam do lektury.">



  <meta property="og:image" content="https://www.samouczekprogramisty.pl/assets/images/2016/09/02_serializacja_artykul.jpg">





  <meta property="article:published_time" content="2016-09-02T00:00:00+02:00">



  <meta property="article:modified_time" content="2021-05-04T23:36:11+02:00">



  

  


<link rel="canonical" href="https://www.samouczekprogramisty.pl/serializacja-w-jezyku-java/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Marcin Pietraszek",
      "url": "https://www.samouczekprogramisty.pl/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Samouczek Programisty Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <link rel="shortcut icon" href="/assets/images/favicon.ico" /> 
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/logo.gif" alt=""></a>
        
        <a class="site-title" href="/">
          Samouczek Programisty
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/kurs-programowania-java/">Kurs programowania Java</a>
            </li><li class="masthead__menu-item">
              <a href="/kurs-aplikacji-webowych/">Kurs aplikacji webowych</a>
            </li><li class="masthead__menu-item">
              <a href="/kurs-sql/">Kurs SQL</a>
            </li><li class="masthead__menu-item">
              <a href="/kontakt/">Kontakt</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Przełącz menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<div class="page__hero--overlay"
  style=" background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('/assets/images/2016/09/02_serializacja_artykul.jpg');"
>
  
    <div class="wrapper">
      <h1 id="page-title" class="page__title" itemprop="headline">
        
          Serializacja w języku Java

        
      </h1>
      
        <p class="page__lead">W artykule tym dowiesz się czym jest serializacja obiektów w Javie. Przeczytasz o klasach takich jak <code class="highlighter-rouge">ObjectInputStream</code> czy <code class="highlighter-rouge">ObjectOutputStream</code> i dowiesz się czym różnią się od innych strumieni. Poznasz nowe słowo kluczowe <code class="highlighter-rouge">transient</code>. Po przeczytaniu artykułu będziesz w stanie napisać swoją mini bazę danych z użyciem mechanizmu serializacji. Zapraszam do lektury.
</p>
      
      
        <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  10 minut(y)

</p>
      
      
      
    </div>
  
  
    <span class="page__hero-caption"><a href="https://www.flickr.com/photos/28653536@N07/">© 28653536@N07</a>
</span>
  
</div>




  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://www.samouczekprogramisty.pl/" itemprop="item"><span itemprop="name">Strona główna</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Serializacja w języku Java</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">

  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Serializacja w języku Java">
    <meta itemprop="description" content="W artykule tym dowiesz się czym jest serializacja obiektów w Javie. Przeczytasz o klasach takich jak ObjectInputStream czy ObjectOutputStream i dowiesz się czym różnią się od innych strumieni. Poznasz nowe słowo kluczowe transient. Po przeczytaniu artykułu będziesz w stanie napisać swoją mini bazę danych z użyciem mechanizmu serializacji. Zapraszam do lektury.">
    <meta itemprop="datePublished" content="September 02, 2016">
    <meta itemprop="dateModified" content="May 04, 2021">

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        <aside class="sidebar__right ">
          
          <nav class="toc">
            <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> Spis treści</h4></header>
            <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#czym-jest-serializacja">Czym jest serializacja</a></li>
<li class="toc-entry toc-h2"><a href="#warunki-wymagane-do-serializacji">Warunki wymagane do serializacji</a>
<ul>
<li class="toc-entry toc-h3"><a href="#interfejs-javaioserializable">Interfejs java.io.Serializable</a></li>
<li class="toc-entry toc-h3"><a href="#konstruktor-bezparametrowy">Konstruktor bezparametrowy</a></li>
<li class="toc-entry toc-h3"><a href="#określić-pola-które-nie-są-serializowalne">Określić pola, które nie są serializowalne</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#przykład-serializacji-obiektu">Przykład serializacji obiektu</a></li>
<li class="toc-entry toc-h2"><a href="#serializacja-drzewa-obiektów">Serializacja drzewa obiektów</a></li>
<li class="toc-entry toc-h2"><a href="#deserializacja-atrybutów-transient">Deserializacja atrybutów transient</a></li>
<li class="toc-entry toc-h2"><a href="#pola-statyczne-a-serializacja">Pola statyczne a serializacja</a></li>
<li class="toc-entry toc-h2"><a href="#specjalna-obsługa-serializacjideserializacji">Specjalna obsługa serializacji/deserializacji</a></li>
<li class="toc-entry toc-h2"><a href="#serializacja-a-dziedziczenie">Serializacja a dziedziczenie</a></li>
<li class="toc-entry toc-h2"><a href="#pełny-wpływ-na-mechanizm-serializacji">Pełny wpływ na mechanizm serializacji</a></li>
<li class="toc-entry toc-h2"><a href="#pole-serialversionuid">Pole serialVersionUID</a></li>
<li class="toc-entry toc-h2"><a href="#materiały-dodatkowe">Materiały dodatkowe</a></li>
<li class="toc-entry toc-h2"><a href="#zadania">Zadania</a></li>
<li class="toc-entry toc-h2"><a href="#podsumowanie">Podsumowanie</a></li>
</ul>
          </nav>
          <hr />
          
          <div class="mailerlite__form">
            <script type="text/javascript" src="https://static.mailerlite.com/data/webforms/698980/y1i5k0.js?v7"></script>
          </div>
          <hr />
          <div class="fb-page">
            <a href="https://www.facebook.com/SamouczekProgramisty"><img src="/assets/images/facebook_logo.gif" alt="Profil Samouczka na Facebooku"/></a>
          </div>
        </aside>
        <p class="notice--info">To jest jeden z artykułów w ramach <a href="https://www.samouczekprogramisty.pl/kurs-programowania-java">darmowego kursu programowania w Javie</a>. Proszę zapoznaj się z pozostałymi częściami, mogą one być pomocne w zrozumieniu materiału z tego artykułu.</p>

<h2 id="czym-jest-serializacja">Czym jest serializacja</h2>

<p>W jednym z poprzednich artykułów przeczytałeś o <a href="/operacje-na-plikach-w-jezyku-java/">strumieniach danych</a>, które pozwalały na zapisywanie oraz odczytywanie danych. Poznałeś wówczas między innymi klasy <code class="highlighter-rouge">DataInputStream</code> oraz <code class="highlighter-rouge">DataOutputStream</code>. Klasy te pomagają zapisywać typy proste i łańcuchy znaków.</p>

<p>Serializacja to wbudowany mechanizm zapisywania obiektów, który pozwala na binarny zapis całego drzewa obiektów. Oznacza to tyle, że jeśli mamy obiekt X, który posiada referencję do obiektu Y to serializując X również Y zostanie automatycznie zapisany w strumieniu wyjściowym.</p>

<p>Tak zapisany obiekt możesz później otworzyć przy kolejnym uruchomieniu programu. Jednak serializacja ma więcej zastosowań.</p>

<p>Dzięki temu mechanizmowi można na przykład przesyłać obiekty przez sieć. Obiekt, który stworzyliśmy na jednym komputerze (wewnątrz pamięci jednej wirtualnej maszyny Java) może być zserializowany, przesłany przez sieć i zdeserializowany na drugim komputerze tworząc nową instancję obiektu (wewnątrz pamięci drugiej wirtualnej maszyny Javy). Na obu tych komputerach wirtualna maszyna Javy musi mieć dostęp do skompilowanej wersji klasy.</p>

<div class="notice--success text-center">
  
<p><span class="c_almost-header">Pobierz opracowania zadań z rozmów kwalifikacyjnych</span></p>

<p>Przygotowałem rozwiązania kilku zadań algorytmicznych z rozmów kwalifikacyjnych. Rozkładam je na czynniki pierwsze i pokazuję różne sposoby ich rozwiązania. Dołącz do grupy <strong>ponad 6147 Samouków</strong>, którzy jako pierwsi dowiadują się o nowych treściach na blogu, a prześlę je na Twój e-mail.</p>

<script type="text/javascript" src="https://static.mailerlite.com/data/webforms/704312/f8q4i2.js?v4"></script>


</div>

<h2 id="warunki-wymagane-do-serializacji">Warunki wymagane do serializacji</h2>

<p>Chociaż serializacja dostępna jest automatycznie dla większości obiektów z biblioteki standardowej to jeśli chcesz móc serializować instancje klas, które sam napiszesz musisz spełnić kilka warunków.</p>

<h3 id="interfejs-javaioserializable">Interfejs <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/io/Serializable.html"><code class="highlighter-rouge">java.io.Serializable</code></a></h3>

<p>Jest to tak zwany interfejs znacznikowy, innymi słowy nie zawiera on żadnej metody. Służy on do pokazania wirtualnej maszynie, że instancje danej klasy implementującej ten interfejs mogą być serializowane. Musisz implementować ten interfejs jeśli chcesz aby twoje klasy były serializowalne. Jeśli będziesz próbował zserializować klasę, która nie implementuje tego interfejsu zostanie rzucony wyjątek typu <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/io/NotSerializableException.html"><code class="highlighter-rouge">NotSerializableException</code></a>.</p>

<h3 id="konstruktor-bezparametrowy">Konstruktor bezparametrowy</h3>

<p>Tutaj reguła niestety nie jest trywialna. Pierwsza klasa w hierarchii dziedziczenia, która nie jest serializowalna musi mieć dostępny konstruktor bezparametrowy. Łatwiej to będzie zrozumieć na przykładzie:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Fruit</span> <span class="o">{}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Apple</span> <span class="kd">extends</span> <span class="nc">Fruit</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Tomato</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{}</span>
</code></pre></div></div>

<p>W przykładzie powyżej klasa <code class="highlighter-rouge">Fruit</code> musi mieć konstruktor bezparametrowy abyśmy mogli poprawnie serializować instancje klasy <code class="highlighter-rouge">Apple</code>. Natomiast ani <code class="highlighter-rouge">Apple</code>, ani <code class="highlighter-rouge">Tomato</code> takiego konstruktora już nie wymagają (<code class="highlighter-rouge">Tomato</code> dziedziczy po <code class="highlighter-rouge">Object</code>, który taki konstruktor posiada).</p>

<p>Dodatkowo istnieje interfejs <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/io/Externalizable.html"><code class="highlighter-rouge">java.io.Externalizable</code></a> (opiszę go dokładnie kilka akapitów niżej), który również zapewnia, że obiekty go implementujące są serializowalne. Jednak w tym przypadku obiekt taki musi także zapewnić konstruktor bezparametrowy, który jest wywoływany w trakcie deserializacji.</p>

<h3 id="określić-pola-które-nie-są-serializowalne">Określić pola, które nie są serializowalne</h3>

<p>Ten krok jest opcjonalny, jednak w bardziej zaawansowanych przypadkach niezbędny. Wyobraź sobie, że napisałeś klasę <code class="highlighter-rouge">Human</code>, która jako jeden z atrybutów posiada wiek zapisany w minutach od urodzenia. Zapisanie tego pola mogłoby prowadzić do odczytania niepoprawnego stanu (zapisujemy obiekt dzisiaj, odczytujemy jutro, wiek w minutach jest zupełnie inny).</p>

<p>Tutaj dochodzimy do słowa kluczowego <code class="highlighter-rouge">transient</code>. Otóż słowo to może być stosowane przed atrybutami klasy. Oznacza ono, że dany atrybut nie jest serializowalny i zostanie pominięty przez mechanizm serializacji<sup id="fnref:serializacja" role="doc-noteref"><a href="#fn:serializacja" class="footnote">1</a></sup>.</p>

<h2 id="przykład-serializacji-obiektu">Przykład serializacji obiektu</h2>

<p>Proszę zwróć uwagę na fragment kodu poniżej, który pokazuje jak mechanizm serializacji działa w praktyce.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="o">(</span><span class="nc">ObjectOutputStream</span> <span class="n">outputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="s">"objects.bin"</span><span class="o">)))</span> <span class="o">{</span>
    <span class="n">outputStream</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
    <span class="n">outputStream</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span>
<span class="o">}</span>

<span class="k">try</span> <span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="s">"objects.bin"</span><span class="o">)))</span> <span class="o">{</span>
    <span class="nc">Integer</span> <span class="n">number</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Integer</span><span class="o">)</span> <span class="n">inputStream</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
    <span class="n">number</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Integer</span><span class="o">)</span> <span class="n">inputStream</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>W pierwszym bloku <a href="/konstrukcja-try-with-resources-w-jezyku-java/">try-with-resources</a> otwieramy strumień typu <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/io/ObjectOutputStream.html"><code class="highlighter-rouge">ObjectOutputStream</code></a>, na którym następnie wywołujemy metodę <code class="highlighter-rouge">writeObject</code> zapisując do strumienia dwie liczby.</p>

<p>W kolejnym bloku dzięki instancji <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/io/ObjectInputStream.html"><code class="highlighter-rouge">ObjectInputStream</code></a> odczytujemy wcześniej zapisane obiekty. Obiekty odczytywane są w takiej samej kolejności w jakiej zostały zapisane, w naszym przypadku na konsoli zostaną wyświetlone liczby 1 a później 2.</p>

<h2 id="serializacja-drzewa-obiektów">Serializacja drzewa obiektów</h2>

<p>Wspomniałem już wcześniej, że mechanizm serializacji automatycznie obsługuje drzewa obiektów. W przykładzie poniżej pokazana jest właśnie taka sytuacja. Instancja klasy <code class="highlighter-rouge">Car</code> posiada atrybuty typów <code class="highlighter-rouge">Engine</code> oraz <code class="highlighter-rouge">Tyre[]</code>. Serializując a następnie deserializując instancję tej klasy wszystkie jej atrybuty zostały także zapisane.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Tyre</span><span class="o">[]</span> <span class="n">tyres</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Tyre</span><span class="o">[]</span> <span class="o">{</span><span class="k">new</span> <span class="nc">Tyre</span><span class="o">(</span><span class="mi">16</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Tyre</span><span class="o">(</span><span class="mi">16</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Tyre</span><span class="o">(</span><span class="mi">16</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Tyre</span><span class="o">(</span><span class="mi">16</span><span class="o">)};</span>
<span class="nc">Engine</span> <span class="n">engine</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Engine</span><span class="o">(</span><span class="s">"some model"</span><span class="o">);</span>
<span class="nc">Car</span> <span class="n">serializedCar</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Car</span><span class="o">(</span><span class="n">engine</span><span class="o">,</span> <span class="n">tyres</span><span class="o">);</span>
<span class="k">try</span> <span class="o">(</span><span class="nc">ObjectOutputStream</span> <span class="n">outputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="s">"object-graph.bin"</span><span class="o">)))</span> <span class="o">{</span>
    <span class="n">outputStream</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">serializedCar</span><span class="o">);</span>
<span class="o">}</span>

<span class="nc">Car</span> <span class="n">deserializedCar</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="s">"object-graph.bin"</span><span class="o">)))</span> <span class="o">{</span>
    <span class="n">deserializedCar</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Car</span><span class="o">)</span> <span class="n">inputStream</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">deserializedCar</span><span class="o">.</span><span class="na">getEngine</span><span class="o">().</span><span class="na">getModel</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">deserializedCar</span><span class="o">.</span><span class="na">getTyres</span><span class="o">().</span><span class="na">length</span><span class="o">);</span>
<span class="o">}</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">serializedCar</span> <span class="o">==</span> <span class="n">deserializedCar</span><span class="o">);</span>
</code></pre></div></div>

<p>Zwróć proszę uwagę na ostatnią linię. W linijce tej porównywane są dwa adresy instancji klasy <code class="highlighter-rouge">Car</code> (pamiętasz <a href="/porownywanie-obiektow-metody-equals-i-hashcode-w-jezyku-java/">różnicę między <code class="highlighter-rouge">==</code> a <code class="highlighter-rouge">equals</code></a>?). Oczywiście linijka ta wyświetli <code class="highlighter-rouge">false</code> na konsoli co dowodzi, że w procesie deserializacji został stworzony zupełnie nowy obiekt klasy <code class="highlighter-rouge">Engine</code>.</p>

<h2 id="deserializacja-atrybutów-transient">Deserializacja atrybutów <code class="highlighter-rouge">transient</code></h2>

<p>Zaraz, jak to? Przecież kilka akapitów wyżej napisałem, że atrybuty poprzedzone słowem kluczowym transient nie są serializowane. Tak to prawda, jednak podczas deserializacji atrybuty tego typu należy zainicjalizować pewną wartością. Otóż dla każdego typu mamy taką domyślną wartość:</p>
<ul>
  <li><code class="highlighter-rouge">boolean</code> – <code class="highlighter-rouge">false</code>,</li>
  <li>liczby całkowite (<code class="highlighter-rouge">int</code>, <code class="highlighter-rouge">long</code>, itd.) – <code class="highlighter-rouge">0</code>,</li>
  <li>liczby ułamkowe (<code class="highlighter-rouge">float</code>, <code class="highlighter-rouge">duble</code>) – <code class="highlighter-rouge">0.0</code>,</li>
  <li>obiekty (<code class="highlighter-rouge">Integer</code>, <code class="highlighter-rouge">Float</code>, <code class="highlighter-rouge">String</code>, <code class="highlighter-rouge">CustomClass</code>, itd.) – <code class="highlighter-rouge">null</code></li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Human</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">transient</span> <span class="nc">Integer</span> <span class="n">age</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Human</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">getAge</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">age</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ClassNotFoundException</span> <span class="o">{</span>
        <span class="nc">Human</span> <span class="n">human</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Human</span><span class="o">(</span><span class="s">"Krzysiek"</span><span class="o">,</span> <span class="mi">21</span><span class="o">);</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">ObjectOutputStream</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="s">"human.bin"</span><span class="o">)))</span> <span class="o">{</span>
            <span class="n">output</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">human</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="s">"human.bin"</span><span class="o">)))</span> <span class="o">{</span>
            <span class="nc">Human</span> <span class="n">readHuman</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Human</span><span class="o">)</span> <span class="n">input</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">readHuman</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">readHuman</span><span class="o">.</span><span class="na">getAge</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>W przykładzie powyżej po deserializacji pole <code class="highlighter-rouge">age</code> będzie miało wartość <code class="highlighter-rouge">null</code> ponieważ jest to wartość domyślna dla atrybutów poprzedzonych słowem kluczowym <code class="highlighter-rouge">transient</code>, które są obiektami.</p>
<h2 id="pola-statyczne-a-serializacja">Pola statyczne a serializacja</h2>

<p>Serializacja dotyczy instancji klasy, nie samej klasy. Zatem jeśli zmodyfikowałeś pole statyczne a następnie zdeserializowałeś taki obiekt wprowadzone zmiany zostaną pominięte. Proszę spójrz na przykład poniżej.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">StaticSerialization</span> <span class="n">object</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StaticSerialization</span><span class="o">();</span>
<span class="n">object</span><span class="o">.</span><span class="na">someField</span> <span class="o">=</span> <span class="mi">200</span><span class="o">;</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">object</span><span class="o">.</span><span class="na">someField</span><span class="o">);</span>

<span class="k">try</span> <span class="o">(</span><span class="nc">ObjectOutputStream</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="s">"static.bin"</span><span class="o">)))</span> <span class="o">{</span>
    <span class="n">output</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>W przykładzie tym modyfikujemy wartość pola statycznego <code class="highlighter-rouge">someField</code> a następnie serializujemy instancję klasy do pliku.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="s">"static.bin"</span><span class="o">)))</span> <span class="o">{</span>
    <span class="nc">StaticSerialization</span> <span class="n">otherObject</span> <span class="o">=</span> <span class="o">(</span><span class="nc">StaticSerialization</span><span class="o">)</span> <span class="n">input</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">otherObject</span><span class="o">.</span><span class="na">someField</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>W drugim uruchomieniu programu (w którym nie zmodyfikowaliśmy wartości atrybutu statycznego <code class="highlighter-rouge">someField</code>) deserializujemy ten sam plik. W tym przypadku otrzymamy wartość 100 a nie 200, które miał obiekt zapisywany do pliku.</p>

<p>To co trzeba zapamiętać to to, że pola statyczne nie są serializowane a są pobierane z <em>aktualnej</em> definicji klasy (nie z klasy z momentu serializacji).</p>

<p>Możemy powiedzieć, że atrybuty <code class="highlighter-rouge">static</code> są też domyślnie <code class="highlighter-rouge">transient</code>. Jak zatem takie zmiany odzwierciedlić podczas deserializacji? Jest na to sposób :)</p>

<h2 id="specjalna-obsługa-serializacjideserializacji">Specjalna obsługa serializacji/deserializacji</h2>

<p>W specyficznych przypadkach masz możliwość zmodyfikowania domyślnego zachowania mechanizmu serializacji. Możesz to zrobić jeśli zaimplementujesz poniższe metody.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">readObject</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">ObjectInputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ClassNotFoundException</span>
<span class="kd">private</span> <span class="kt">void</span> <span class="nf">writeObject</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">ObjectOutputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span>
</code></pre></div></div>

<p>Metoda <code class="highlighter-rouge">readObject(java.io.ObjectInputStream stream)</code>, którą zaimplementujesz jest automatycznie wywoływana w momencie odczytywania obiektu ze strumienia, czyli w trakcie wywołania metody
<a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/io/ObjectInputStream.html#readObject()"><code class="highlighter-rouge">ObjectInputStream.readObject()</code></a>.</p>

<p>Mechanizm ten wygląda podobnie w przypadku zapisu obiektu. Metoda <code class="highlighter-rouge">writeObject(java.io.ObjectOutputStream stream)</code>, którą zaimplementujesz jest automatycznie wywoływana w momencie zapisywania obiektu do strumienia, czyli w trakcie wywołania metody <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/io/ObjectOutputStream.html#writeObject(java.lang.Object)"><code class="highlighter-rouge">ObjectOutputStream.writeObject()</code></a>.</p>

<p>Poniższy przykład powinien Ci pomóc w zrozumieniu tego mechanizmu:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomSerialization</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">transient</span> <span class="kt">int</span> <span class="n">someField</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">otherField</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CustomSerialization</span><span class="o">(</span><span class="kt">int</span> <span class="n">someField</span><span class="o">,</span> <span class="nc">String</span> <span class="n">otherField</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">someField</span> <span class="o">=</span> <span class="n">someField</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">otherField</span> <span class="o">=</span> <span class="n">otherField</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ClassNotFoundException</span> <span class="o">{</span>
        <span class="nc">CustomSerialization</span> <span class="n">writtenObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CustomSerialization</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="s">"something"</span><span class="o">);</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">ObjectOutputStream</span> <span class="n">outputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="s">"custom-serialization.bin"</span><span class="o">)))</span> <span class="o">{</span>
            <span class="n">outputStream</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">writtenObject</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="s">"custom-serialization.bin"</span>   <span class="o">)))</span> <span class="o">{</span>
            <span class="nc">CustomSerialization</span> <span class="n">readObject</span> <span class="o">=</span> <span class="o">(</span><span class="nc">CustomSerialization</span><span class="o">)</span> <span class="n">inputStream</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">readObject</span><span class="o">.</span><span class="na">someField</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">readObject</span><span class="o">.</span><span class="na">otherField</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">readObject</span><span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ClassNotFoundException</span> <span class="o">{</span>
        <span class="n">stream</span><span class="o">.</span><span class="na">defaultReadObject</span><span class="o">();</span>
        <span class="n">someField</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="na">readInt</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">writeObject</span><span class="o">(</span><span class="nc">ObjectOutputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="n">stream</span><span class="o">.</span><span class="na">defaultWriteObject</span><span class="o">();</span>
        <span class="n">stream</span><span class="o">.</span><span class="na">writeInt</span><span class="o">(</span><span class="n">someField</span> <span class="o">+</span> <span class="mi">1000</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Jak widzisz obie metody są tu zaimplementowane. <code class="highlighter-rouge">writeObject</code> jako argument dostaje strumień, do którego powinniśmy zapisać nasz obiekt. Metoda <code class="highlighter-rouge">readObject</code> jako jedyny argument przyjmuje strumień, z którego powinniśmy odczytać stan obiektu.</p>

<p>Warto tutaj zwrócić uwagę na to, że klasa <code class="highlighter-rouge">ObjectInputStream</code> posiada metodę <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/io/ObjectInputStream.html#defaultReadObject()"><code class="highlighter-rouge">defaultReadObject</code></a>, która przeprowadza standardową deserializację, którą możesz rozszerzyć. Podobnie wygląda to w przypadku klasy <code class="highlighter-rouge">ObjectOutputStream</code> i metody <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/io/ObjectOutputStream.html#defaultWriteObject()"><code class="highlighter-rouge">defaultWriteObject</code></a>. Metody te mogą być wywołane wyłącznie w trakcie (de)serializacji obiektu. Zajmują się one (de)serializacją atrybutów klasy, które nie są oznaczone jako <code class="highlighter-rouge">static</code> lub <code class="highlighter-rouge">transient</code>.</p>

<h2 id="serializacja-a-dziedziczenie">Serializacja a dziedziczenie</h2>

<p>W poprzednich przykładach użyliśmy klasy <code class="highlighter-rouge">Engine</code>, która implementuje interfejs <code class="highlighter-rouge">Serializable</code>. Załóżmy, że utworzyliśmy klasę <code class="highlighter-rouge">DieselEngine</code>, która dziedziczy po <code class="highlighter-rouge">Engine</code>. Automatycznie instancje klasy <code class="highlighter-rouge">DieselEngine</code> będą implementowały interfejs <code class="highlighter-rouge">Serializable</code> (dziedzicząc go z <code class="highlighter-rouge">Engine</code>). Co powinniśmy zrobić jeśli nie chcielibyśmy aby nasz <code class="highlighter-rouge">DieselEngine</code> był serializowalny? Należy użyć wspomnianego już wyjątku <code class="highlighter-rouge">NotSerializableException</code> jak w przykładzie poniżej:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DieselEngine</span> <span class="kd">extends</span> <span class="nc">Engine</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">DieselEngine</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="s">"diesel"</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">writeObject</span><span class="o">(</span><span class="nc">ObjectOutputStream</span> <span class="n">out</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotSerializableException</span><span class="o">(</span><span class="s">"DieselEngine isn't serializable!"</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">readObject</span><span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">in</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotSerializableException</span><span class="o">(</span><span class="s">"DieselEngine isn't serializable!"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="pełny-wpływ-na-mechanizm-serializacji">Pełny wpływ na mechanizm serializacji</h2>

<p>Istnieje jeszcze jeden, dużo mniej popularny sposób zapewnienia iż obiekt może być serializowany. Jest nim interfejs <code class="highlighter-rouge">Externalizable</code>. W tym przypadku interfejs ten zawiera dwie metody, które musimy zaimplementować. Dodatkowo takie klasy muszą mieć konstruktor bezparametrowy, reszta pozostaje bez zmian. W przypadku tego podejścia cały protokół serializacji, kolejność zapisanych pól, format etc. leży po naszej stronie. Poniżej prosty przykład, w którym używam właśnie takiego podejścia.</p>

<p>W tym przypadku do utworzenia obiektu mechanizm serializacji używa standardowego konstruktora bezparametrowego. Po czym wywołuje na tej instancji metodę <code class="highlighter-rouge">readExternal</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomProtocolSerialization</span> <span class="kd">implements</span> <span class="nc">Externalizable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">field</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="nf">CustomProtocolSerialization</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="nf">CustomProtocolSerialization</span><span class="o">(</span><span class="nc">String</span> <span class="n">field</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">field</span> <span class="o">=</span> <span class="n">field</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ClassNotFoundException</span> <span class="o">{</span>
        <span class="nc">CustomProtocolSerialization</span> <span class="n">object</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CustomProtocolSerialization</span><span class="o">(</span><span class="s">"field value"</span><span class="o">);</span>
 
        <span class="k">try</span> <span class="o">(</span><span class="nc">ObjectOutputStream</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="s">"externalizable.bin"</span><span class="o">)))</span> <span class="o">{</span>
            <span class="n">output</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="k">try</span> <span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="s">"externalizable.bin"</span><span class="o">)))</span> <span class="o">{</span>
            <span class="nc">CustomProtocolSerialization</span> <span class="n">readObject</span> <span class="o">=</span> <span class="o">(</span><span class="nc">CustomProtocolSerialization</span><span class="o">)</span> <span class="n">input</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">readObject</span><span class="o">.</span><span class="na">field</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeExternal</span><span class="o">(</span><span class="nc">ObjectOutput</span> <span class="n">out</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="n">out</span><span class="o">.</span><span class="na">writeUTF</span><span class="o">(</span><span class="n">field</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">readExternal</span><span class="o">(</span><span class="nc">ObjectInput</span> <span class="n">in</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ClassNotFoundException</span> <span class="o">{</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readUTF</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="pole-serialversionuid">Pole <code class="highlighter-rouge">serialVersionUID</code></h2>

<p>Dodatkowo musisz wiedzieć o statycznym polu w klasie o nazwie <code class="highlighter-rouge">serialVersionUID</code>. Jego pełna definicja wygląda następująco:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">serialVersionUID</span><span class="o">;</span>
</code></pre></div></div>

<p>Pole to ma specyficzne zastosowanie. Mechanizm serializacji używa go do upewnienia się, że deserializowany obiekt „pasuje” do danych zapisanych w strumieniu. Wie o tym na podstawie wartości tego pola. Jeśli w zdeserializowanym obiekcie wartość tego pola jest taka sama jak aktualnej definicji klasy wówczas można bezpiecznie przeprowadzić deserializację.</p>

<p>Kiedy taka sytuacja może wystąpić? Załóżmy, że dzisiaj napiszesz klasę <code class="highlighter-rouge">Human</code>, zdeserializujesz jej instancję i zapiszesz w pliku na dysku. Po jakimś czasie wprowadzisz zmiany w klasie i będziesz chciał odczytać starą wersję z pliku. W niektórych przypadkach taka operacja nie będzie dozwolona. Właśnie wtedy pole <code class="highlighter-rouge">serialVersionUID</code> może pomóc w wykryciu takiej sytuacji.</p>

<p>Pole to możesz ustawić samodzielnie, jeśli tego nie zrobisz kompilator wygeneruje tę wartość za Ciebie na podstawie definicji klasy.</p>

<h2 id="materiały-dodatkowe">Materiały dodatkowe</h2>

<p>Na początek zestaw dokumentacji do klas, związanych z tematem, jak zwykle znajdziesz tam ogrom informacji.</p>
<ul>
  <li><a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/io/Serializable.html"><code class="highlighter-rouge">Serializable</code></a></li>
  <li><a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/io/Externalizable.html"><code class="highlighter-rouge">Externalizable</code></a></li>
  <li><a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/io/ObjectOutputStream.html"><code class="highlighter-rouge">ObjectOutputStream</code></a></li>
  <li><a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/io/ObjectInputStream.html"><code class="highlighter-rouge">ObjectInputStream</code></a></li>
  <li><a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/io/NotSerializableException.html"><code class="highlighter-rouge">NotSerializableException</code></a></li>
</ul>

<p>Dodatkowo możesz zajrzeć do <a href="https://docs.oracle.com/en/java/javase/12/docs/specs/serialization/">specyfikacja mechanizmu serializacji</a> albo <a href="http://www.oracle.com/technetwork/articles/java/javaserial-1536170.html">artykułu na stronie Oracle</a>. Znalazłem też inne opracowanie, które poruszą także zagadnienie <a href="http://wazniak.mimuw.edu.pl/index.php?title=PO_Serializacja">serializacji, także do formatu XML</a>. Możesz też rzucić okiem na <a href="https://github.com/SamouczekProgramisty/KursJava/tree/master/18_serializacja/src/main/java/pl/samouczekprogramisty/kursjava/serialization">przykłady użyte w tym artykule</a>.</p>

<h2 id="zadania">Zadania</h2>

<p>Na koniec jak zwykle zadania dla Ciebie do przećwiczenia materiału z tego artykułu.</p>
<ul>
  <li>Napisz program, który poprosi użytkownika o wprowadzenie kilku imion, imiona te zapisz w liście a następnie zserializuj ją do pliku. Napisz metodę, która odczyta ten plik i wyświetli zawartość listy na konsoli. Wiesz, że właśnie napisałeś prostą bazę danych? ;)</li>
  <li>Napisz klasę <code class="highlighter-rouge">Human</code>, która będzie miała dwa atrybuty <code class="highlighter-rouge">name</code> typu <code class="highlighter-rouge">String</code> oraz <code class="highlighter-rouge">age</code> typu <code class="highlighter-rouge">int</code>. Jak należałoby serializować instancje tej klasy aby zawsze poprawnie deserializować wiek (z dokładnością do roku)? (Wskazówka, możesz użyć metody <code class="highlighter-rouge">Calendar.getInstance().get(Calendar.YEAR)</code>, która zwraca aktualny rok)</li>
</ul>

<p>Przygotowałem też dla Ciebie <a href="https://github.com/SamouczekProgramisty/KursJava/tree/master/18_serializacja/src/main/java/pl/samouczekprogramisty/kursjava/serialization/exercise">przykładowe rozwiązania</a> powyższych zadań, jednak traktuj je proszę jako ostatnią deskę ratunku :) Więcej nauczysz się próbując samemu rozwiązać powyższe zadania.</p>

<h2 id="podsumowanie">Podsumowanie</h2>

<p>Po przeczytaniu tego artykułu wiesz już czym są klasy <code class="highlighter-rouge">ObjectOutputStream</code> i <code class="highlighter-rouge">ObjectInputStream</code>. Znasz zasady serializacji, poznałeś słowo kluczowe <code class="highlighter-rouge">transient</code>. Teraz jesteś w stanie zapisać i odczytać każdą instancję klasy, którą stworzysz.</p>

<p>Bardzo się cieszę, że przeczytałeś cały artykuł. Na koniec mam do Ciebie prośbę. Proszę przekaż adres bloga swoim znajomym, w grupie uczy się raźniej ;) Jeśli nie chcesz ominąć nowych artykułów dopisz się do newslettera i polub <a href="https://www.facebook.com/SamouczekProgramisty">stronę Samouczka na Facebook’u</a>. Miłego dnia i do następnego razu :)</p>
<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:serializacja" role="doc-endnote">
      <p>Istnieje też inny, mniej popularny sposób ominięcia pól podczas serializacji– użycie pola <code class="highlighter-rouge">serialPersistentFields</code> (jest ono dokładniej opisane w <a href="https://docs.oracle.com/en/java/javase/12/docs/specs/serialization/serial-arch.html#defining-serializable-fields-for-a-class">specyfikacji</a>). <a href="#fnref:serializacja" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

        

<div class="notice--success text-center">
  
<p><span class="c_almost-header">Pobierz opracowania zadań z rozmów kwalifikacyjnych</span></p>

<p>Przygotowałem rozwiązania kilku zadań algorytmicznych z rozmów kwalifikacyjnych. Rozkładam je na czynniki pierwsze i pokazuję różne sposoby ich rozwiązania. Dołącz do grupy <strong>ponad 6147 Samouków</strong>, którzy jako pierwsi dowiadują się o nowych treściach na blogu, a prześlę je na Twój e-mail.</p>

<script type="text/javascript" src="https://static.mailerlite.com/data/webforms/698960/m0b4d5.js?v4"></script>


</div>

        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Kategorie: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/kategorie/#kurs-programowania-java" class="page__taxonomy-item" rel="tag">Kurs programowania Java</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Ostatnia aktualizacja:</strong> <time datetime="2021-05-04">2021-05-04</time></p>
        
        <p><strong><i class="fas fa-fw fa-child" aria-hidden="true"></i> Autor: </strong><a href="/o-mnie/">Marcin Pietraszek</a></p>
        <hr />
        <p>
          Nie popełnia błędów tylko ten, kto nic nie robi ;). Bardzo możliwe, że znajdziesz błąd, literówkę, coś co wymaga poprawy. Jeśli chcesz możesz samodzielnie 
          <a href="https://github.com/SamouczekProgramisty/samouczekprogramisty.github.io/edit/source/_posts/2016-09-02-serializacja-w-jezyku-java.md">poprawić tę stronę</a>. Jeśli nie chcesz poprawiać błędu, który udało Ci się znaleźć będę wdzięczny jeśli go 
          <a href="https://github.com/SamouczekProgramisty/samouczekprogramisty.github.io/issues/new?title=Błąd%20na%20stronie:%20_posts/2016-09-02-serializacja-w-jezyku-java.md">zgłosisz</a>. Z góry dziękuję!
        </p>
      </footer>
    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Zostaw komentarz</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">Także może Ci się spodobać</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/2019/02/02_watki_w_jezyku_java_artykul.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/watki-w-jezyku-java/" rel="permalink">Wątki w języku Java
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  10 minut(y)

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Artykuł ten opisuje wątki w języku Java. Po jego lekturze dowiesz się czym jest wątek, jaki ma cykl życia i jak go uruchomić. Dowiesz się czym jest synchroni...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/2016/01/24_dziedziczenie_w_jezyku_java_artykul.jpeg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/dziedziczenie-w-jezyku-java/" rel="permalink">Dziedziczenie w języku Java
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  10 minut(y)

</p>
    
    <p class="archive__item-excerpt" itemprop="description">W innych artykułach omawiałem pewne aspekty programowania obiektowego. Wiesz już o interfejsach i dlaczego warto ich używać. Dzisiaj przeczytasz o dziedzicze...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/2016/03/23_java_typy_generyczne_artykul.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/typy-generyczne-w-jezyku-java/" rel="permalink">Typy generyczne w języku Java
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  11 minut(y)

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Dzień dobry! Nadszedł czas na poznanie typów generycznych. Dowiesz się o “szablonach” w języku Java, które pozwalają na tworzenie bardziej uniwersalnych typó...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/2019/04/20_jak_pisac_dobry_kod_w_javie_artykul.jpeg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/jak-pisac-kod-wysokiej-jakosci-w-jezyku-java/" rel="permalink">Jak pisać kod wysokiej jakości w języku Java
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  17 minut(y)

</p>
    
    <p class="archive__item-excerpt" itemprop="description">W artykule przeczytasz o tym czym jest konwencja nazewnicza. Dowiesz się jak jej stosować. Na przykładach pokażę Ci najczęściej popełniane błędy wraz z propo...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><div class="search-searchbar"></div>
  <div class="search-hits"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">

    
      <li><strong>Śledź:</strong></li>
    

    
      
        
          <li><a href="https://www.facebook.com/SamouczekProgramisty" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i> Facebook</a></li>
        
      
        
          <li><a href="https://github.com/SamouczekProgramisty" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.youtube.com/channel/UCisPQ5nxB6yw3SfJPFWKTEg" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> YouTube</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>

  <ul>
    <li><a href="https://www.samouczekprogramisty.pl/o-mnie/">O mnie</a></li>
    <li><a href="https://www.samouczekprogramisty.pl/o-blogu/">O blogu</a></li>
    <li><a href="https://www.samouczekprogramisty.pl/polityka-prywatnosci/">Polityka prywatności</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2015-2022 Marcin Pietraszek</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>


<!-- Including InstantSearch.js library and styling -->
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css">

<script>
// Instanciating InstantSearch.js with Algolia credentials
const search = instantsearch({
  appId: 'BAIWADE3K7',
  apiKey: '4a78df6a4d9f820ebbdb0a35f834b174',
  indexName: 'prod_samouczek',
  searchParameters: {
    restrictSearchableAttributes: [
      'title',
      'content'
    ]
  }
});

const hitTemplate = function(hit) {
  const url = hit.url;
  const title = hit._highlightResult.title.value;
  const content = hit._highlightResult.html.value;

  return `
    <div class="list__item">
      <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
        <h2 class="archive__item-title" itemprop="headline"><a href="${url}">${title}</a></h2>
        <div class="archive__item-excerpt" itemprop="description">${content}</div>
      </article>
    </div>
  `;
}

// Adding searchbar and results widgets
search.addWidget(
  instantsearch.widgets.searchBox({
    container: '.search-searchbar',
    poweredBy: true,
    placeholder: 'Szukaj...'
  })
);
search.addWidget(
  instantsearch.widgets.hits({
    container: '.search-hits',
    templates: {
      item: hitTemplate,
      empty: 'Brak wyników',
    }
  })
);

// Starting the search only when toggle is clicked
$(document).ready(function () {
  $(".search__toggle").on("click", function() {
    if(!search.started) {
      search.start();
    }
  });
});
</script>





  <script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-68536783-1']);
  
    _gaq.push(['_gat._anonymizeIp']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://www.samouczekprogramisty.pl/serializacja-w-jezyku-java/";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "379 http://www.samouczekprogramisty.pl/?p=379"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://samouczekprogramisty.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Proszę włacz obsługę JavaScript żeby móc zobaczyć komentarze.</noscript>


  





  </body>
</html>
